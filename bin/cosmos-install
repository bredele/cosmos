#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander');
var path = require('path');
var resolve = path.resolve;
var unzip = require('unzip');
var utils = require('../utils/utils');
var request = require('request');
var ProgressBar = require('progress');


/**
 * Options.
 */

program
  .usage('[name ...]')
  .option('-v, --verbose', 'verbose output')
  .parse(process.argv);


/**
 * Examples.
 */

program.on('--help', function(){
  console.log('  Examples:');
  console.log();
  console.log('    # install a single cosmos project');
  console.log('    $ component install github/name');
  console.log();
});


//get project's name

var path = program.args[0];


//extract zip

if(path) {
  var bar  = new ProgressBar(' \033[33mdownloading\033[m : [:bar] :percent :etas', {
      complete: '=',
      incomplete: ' ',
      width: 20,
      total: 40940
  });
  var split = path.split('/');
  var url = '/' + split[0] + '/' + split[1] + '/zip/master';
  utils.log('install', path);
  request('https://codeload.github.com' + url, function(err, res, body) {
    if(body === 'Not Found') return utils.fatal(body);
    console.log();
    utils.log('parse', path);
  })
  .on('data', function(chunk) {
    bar.tick(chunk.length);
  })
  .pipe(unzip.Extract({
    path: resolve('.')
  }))
  .on('error', function(msg) {});
    
  //utils.log('complete', path);
}